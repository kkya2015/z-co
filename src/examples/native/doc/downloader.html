<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Downloader</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" href="res/doc.css">
  <style type="text/css"></style>
</head>
<body>
  <h1>downloader</h1>
  <hr />
  <p>downloader模块管理文件下载，用于从网络下载各种文件，可支持跨域访问操作和支持多文件下载。</p>
  <h3>索引</h3>
  <hr />
  <h3>
    <a href="#方法">方法</a>
    ：
  </h3>
  <ul>
    <li>
      <a href="#createDownload">createDownload</a>
      ：新建下载任务
    </li>
    <li>
      <a href="#clear">clear</a>
      ：清除指定状态的下载任务
    </li>
    <li>
      <a href="#enumerate">enumerate</a>
      ：枚举指定任务状态的下载任务
    </li>
    <li>
      <a href="#getDownLoaderById">getDownLoaderById</a>
      ：获取指定任务Id的下载任务
    </li>
    <li>
      <a href="#remove">remove</a>
      ：清除单个下载任务
    </li>
    <li>
      <a href="#setMaxRunningSize">setMaxRunningSize</a>
      ：设置并发任务最大数
    </li>
    <li>
      <a href="#setSpeed">setSpeed</a>
      ：设置总下载速度（KB/S），每秒多少KB，仅支持Android平台
    </li>
    <li>
      <a href="#startAll">startAll</a>
      ：开始所有下载任务
    </li>
  </ul>
  <h3>
    <a href="#对象">对象</a>
    ：
  </h3>
  <ul>
    <li>
      <a href="#Downloader">Downloader</a>
      ：单个下载任务
      <ul>
        <li>
          方法
          <ul>
            <li>
              <a href="#getId">getId</a>
              ：获取下载任务的标识
            </li>
            <li>
              <a href="#getUrl">getUrl</a>
              ：下载任务的服务器地址，在创建任务时设置的值。
            </li>
            <li>
              <a href="#getPath">getPath</a>
              ：获取下载文件保存的真实路径
            </li>
            <li>
              <a href="#getState">getState</a>
              ：获取下载任务的标识
            </li>
            <li>
              <a href="#getOptions">getOptions</a>
              ：获取下载任务的参数
            </li>
            <li>
              <a href="#getDownloadedSize">getDownloadedSize</a>
              ：获取已完成下载文件的大小
            </li>
            <li>
              <a href="#getTotalSize">getTotalSize</a>
              ：获取下载任务文件的总大小
            </li>
            <li>
              <a href="#start">start</a>
              ：开始下载任务
            </li>
            <li>
              <a href="#pause">pause</a>
              ：暂停下载任务
            </li>
            <li>
              <a href="#resume">resume</a>
              ：继续下载任务
            </li>
            <li>
              <a href="#abort">abort</a>
              ：取消下载任务
            </li>
            <li>
              <a href="#addEventListener">addEventListener</a>
              ：添加下载任务事件监听器
            </li>
            <li>
              <a href="#removeEventListener">removeEventListener</a>
              ：移除下载任务事件监听器
            </li>
            <li>
              <a href="#addCompletedListener">addCompletedListener</a>
              ：添加下载任务事件完成监听器
            </li>
            <li>
              <a href="#removeCompletedListener">removeCompletedListener</a>
              ：移除下载任务事件完成监听器
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
  <hr />
  <h3>
    <div id="方法">方法</div>
  </h3>
  <hr />
  <h4>
    <div id="createDownload" style="color:red">createDownload</div>
  </h4>
  <ul>
    <li>
      <h4>
        app.downloader.createDownload(url, option)   ⇒
        <a href="#Downloader">Downloader</a>
      </h4>
      <p>1、创建下载任务，创建成功则返回Download对象。</br>
      2、在任务结束后，要及时清除任务，以免内存溢出。
    </br>
    3、重复创建任务，返回原任务 。
  </br>
  4、在新建task时，如果其参数中的url和option中的filePath和已存在的task相同，则返回原来已生成的task。
</br>
</p>
<ul>
<li> <strong>url</strong>
  ：要下载文件资源地址
  <ul>
    <li> <strong>type</strong>
      ：String
    </li>
    <li>
      <strong>默认值</strong>
      ：无
    </li>
  </ul>
</li>
<li>
  <strong>option</strong>
  ：下载任务的参数
  <ul>
    <li>
      <strong>type</strong>
      ：JSON
    </li>
    <li>
      <strong>默认值</strong>
      ：无
    </li>
    <li>
      <strong>keys</strong>
      <ul>
        <li>
          <strong>method</strong>
          ：( <em>String</em>
          )网络请求类型。支持“GET”、“POST”请求。
          <ul>
            <li>默认值：无</li>
          </ul>
        </li>
        <li>
          <strong>filePath</strong>
          ：( <em>String</em>
          )下载文件保存的路径
          <ul>
            <li>默认值：无</li>
          </ul>
        </li>
        <li>
          <strong>timeout</strong>
          ：(
          <em>Number</em>
          )下载任务超时时间，单位为s，超时时间为服务器响应请求的时间。
          <ul>
            <li>默认值：120</li>
          </ul>
        </li>
        <li>
          <strong>retry</strong>
          ：(
          <em>Number</em>
          )下载任务重试次数
          <ul>
            <li>默认值：3</li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</li>
</ul>
</li>
<li>
<h5>示例：</h5>
<pre><code>    var downloader = app.downloader.createDownload('url', {
        method: 'GET',
        timeout: 60,
        retry: 3,
        filePath: 'data://download/a.pdf'
    });
</code></pre>

</li>
</ul>
<h4>
<div id="clear" style="color:red">clear</div>
</h4>
<ul>
<li>
<h4>app.downloader.clear([state])   ⇒ void</h4>
<p>清除指定状态的下载任务。</p>
<ul>
<li>
  <strong>state</strong>
  ：要枚举下载任务的状态。
  <ul>
    <li>
      <strong>type</strong>
      ：Number
    </li>
    <li>
      <strong>默认值</strong>
      ：-1
    </li>
    <li>
      <strong>取值范围</strong>
      <ul>
        <li>-1：全部下载任务状态</li>
        <li>0：初始化</li>
        <li>1：下载任务进行中</li>
        <li>2：下载任务暂停</li>
        <li>3：下载任务取消</li>
        <li>4：下载任务已完成</li>
        <li>5：下载任务出现错误</li>
      </ul>
    </li>
  </ul>
</li>
</ul>
</li>
<li>
<h5>示例：</h5>
<pre><code>app.downloader.clear(1)</code></pre>

</li>
</ul>
<h4>
<div id="enumerate" style="color:red">enumerate</div>
</h4>
<ul>
<li>
<h4>app.downloader.enumerate([state])   ⇒ Array</h4>
<p>枚举指定状态的下载任务。返回值为 枚举到的下载任务对象数组。</p>
<ul>
<li>
  <strong>state</strong>
  ：要枚举下载任务的状态。
  <ul>
    <li>
      <strong>type</strong>
      ：Number
    </li>
    <li>
      <strong>默认值</strong>
      ：-1
    </li>
    <li>
      <strong>取值范围</strong>
      <ul>
        <li>-1：全部下载任务状态</li>
        <li>0：初始化</li>
        <li>1：下载任务进行中</li>
        <li>2：下载任务暂停</li>
        <li>3：下载任务取消</li>
        <li>4：下载任务已完成</li>
        <li>5：下载任务出现错误</li>
      </ul>
    </li>
  </ul>
</li>
</ul>
</li>
<li>
<h5>示例：</h5>
<pre><code>var downloaders = app.downloader.enumerate(1)</code></pre>

</li>
</ul>
<h4>
<div id="getDownLoaderById" style="color:red">getDownLoaderById</div>
</h4>
<ul>
<li>
<h4>
app.downloader.getDownLoaderById(id)   ⇒
<a href="#Downloader">Downloader</a>
</h4>
<p>
通过id获取任务，如果当任务下载时，程序出现异常（断网、进程被杀），再次下载时可通过此方法获取以前未下载完的任务执行start继续下载，这样可节约系统资源。
</p>
<ul>
<li>
  <strong>id</strong>
  ：要获取下载任务的id。
  <ul>
    <li>
      <strong>type</strong>
      ：Number
    </li>
    <li>
      <strong>默认值</strong>
      ：无
    </li>
  </ul>
</li>
</ul>
</li>
<li>
<h5>示例：</h5>
<pre><code>var  downloader = app.downloader.getDownLoaderById(1)</code></pre>

</li>
</ul>
<h4>
<div id="remove" style="color:red">remove</div>
</h4>
<ul>
<li>
<h4>app.downloader.remove(id)   ⇒ void</h4>
<p>清除单个下载任务</p>
<ul>
<li>
  <strong>id</strong>
  ：要清除下载任务的id。
  <ul>
    <li>
      <strong>type</strong>
      ：Number
    </li>
    <li>
      <strong>默认值</strong>
      ：无
    </li>
  </ul>
</li>
</ul>
</li>
<li>
<h5>示例：</h5>
<pre><code>    var downloader = app.downloader.createDownload('url', {
        method: 'GET',
        timeout: 60,
        retry: 3,
        filePath: 'data://download/a.pdf'
    });

    app.downloader.remove(downloader.getId())
</code></pre>

</li>
</ul>
<h4>
<div id="setMaxRunningSize" style="color:red">setMaxRunningSize</div>
</h4>
<ul>
<li>
<h4>app.downloader.setMaxRunningSize(num)   ⇒ void</h4>
<p>1、设置下载并发任务最大数，需注意并发数越大越浪费资源</br>
2、如开启的任务数量大于并发数，则会进入等待队列；后续当正在下载中的任务数小于并发数时，会自动从等待队列队首取任务并开始下载
</p>
<ul>
<li>
<strong>num</strong>
：任务并发数
<ul>
  <li>
    <strong>type</strong>
    ：Number
  </li>
  <li>
    <strong>默认值</strong>
    ：5
  </li>
</ul>
</li>
</ul>
</li>
<li>
<h5>示例：</h5>
<pre><code>app.downloader.setMaxRunningSize(6)</code></pre>

</li>
</ul>
<h4>
<div id="setSpeed" style="color:red">setSpeed</div>
</h4>
<ul>
<li>
<h4>app.downloader.setSpeed(speed)   ⇒ void</h4>
<p>设置总下载速度</p>
<ul>
<li>
<strong>speed</strong>
：下载速度（KB/S），speed&lt;=0不限速。
<ul>
  <li>
    <strong>type</strong>
    ：Number
  </li>
  <li>
    <strong>默认值</strong>
    ：5
  </li>
</ul>
</li>
</ul>
</li>
<li>
<h5>示例：</h5>
<pre><code>app.downloader.setSpeed(100)</code></pre>

</li>
</ul>
<h4>
<div id="startAll" style="color:red">startAll</div>
</h4>
<ul>
<li>
<h4>app.downloader.startAll()   ⇒ void</h4>
<p>开始所有下载任务</p>
</li>
<li>
<h5>示例：</h5>
<pre><code>app.downloader.startAll()</code></pre>

</li>
</ul>
<hr />
<h3>
<div id="对象">对象</div>
</h3>
<hr />
<h4>
<div id="Downloader" style="color:red">Downloader</div>
</h4>
<pre><code>    var downloader = app.downloader.createDownload('url', {
        method: 'GET',
        timeout: 60,
        retry: 3,
        filePath: 'data://download/a.pdf'
    });
</code></pre>

<ul>
<li>
<h4>
<div id="getId" style="color:red">getId()   ⇒ Number</div>
</h4>
<p>获取下载任务的标识，在创建任务时系统自动分配，用于标识下载任务的唯一性。</p>
</li>
<li>
<h5>示例：</h5>
<pre><code>    var downloader = app.downloader.createDownload('url', {
        method: 'GET',
        timeout: 60,
        retry: 3,
        filePath: 'data://download/a.pdf'
    });

    var id = downloader.getId();
</code></pre>

</li>
<li>
<h4>
<div id="getUrl" style="color:red">getUrl()   ⇒ String</div>
</h4>
<p>获取下载任务的服务器地址，在创建任务时设置的值。</p>
</li>
<li>
<h5>示例：</h5>
<pre><code>    var downloader = app.downloader.createDownload('url', {
        method: 'GET',
        timeout: 60,
        retry: 3,
        filePath: 'data://download/a.pdf'
    });

    var url = downloader.getUrl();
</code></pre>

</li>
<li>
<h4>
<div id="getPath" style="color:red">getPath()   ⇒ String</div>
</h4>
<p>获取下载文件保存的真实路径</p>
</li>
<li>
<h5>示例：</h5>
<pre><code>    var downloader = app.downloader.createDownload('url', {
        method: 'GET',
        timeout: 60,
        retry: 3,
        filePath: 'data://download/a.pdf'
    });

    var path = downloader.getPath();
</code></pre>

</li>
<li>
<h4>
<div id="getState" style="color:red">getState()   ⇒ Number</div>
</h4>
<p>获取下载任务的状态</p>
</li>
<li>
<h5>示例：</h5>
<pre><code>    var downloader = app.downloader.createDownload('url', {
        method: 'GET',
        timeout: 60,
        retry: 3,
        filePath: 'data://download/a.pdf'
    });

    var state = downloader.getState();
</code></pre>

</li>
<li>
<h4>
<div id="getOptions" style="color:red">getOptions()   ⇒ JSON</div>
</h4>
<p>获取下载任务配置的参数</p>
</li>
<li>
<h5>示例：</h5>
<pre><code>    var downloader = app.downloader.createDownload('url', {
        method: 'GET',
        timeout: 60,
        retry: 3,
        filePath: 'data://download/a.pdf'
    });

    var options = downloader.getOptions();
</code></pre>

</li>
<li>
<h4>
<div id="getDownloadedSize" style="color:red">getDownloadedSize()   ⇒ Number</div>
</h4>
<p>获取下载任务已完成下载文件的大小，单位为字节(Byte)。</p>
</li>
<li>
<h5>示例：</h5>
<pre><code>    var downloader = app.downloader.createDownload('url', {
        method: 'GET',
        timeout: 60,
        retry: 3,
        filePath: 'data://download/a.pdf'
    });

    var size = downloader.getDownloadedSize();
</code></pre>

</li>
<li>
<h4>
<div id="getTotalSize" style="color:red">getTotalSize()   ⇒ Number</div>
</h4>
<p>获取下载任务要下载文件的总大小，单位为字节（Byte）。</p>
</li>
<li>
<h5>示例：</h5>
<pre><code>    var downloader = app.downloader.createDownload('url', {
        method: 'GET',
        timeout: 60,
        retry: 3,
        filePath: 'data://download/a.pdf'
    });

    var totalSize = downloader.getTotalSize();
</code></pre>

</li>
<li>
<h4>
<div id="start" style="color:red">start()   ⇒ void</div>
</h4>
<p>开始下载任务，如果任务已经处于开始状态则无任何响应。 通常在创建任务或暂停任务后重新开始。</p>
</li>
<li>
<h5>示例：</h5>
<pre><code>    var downloader = app.downloader.createDownload('url', {
        method: 'GET',
        timeout: 60,
        retry: 3,
        filePath: 'data://download/a.pdf'
    });

    downloader.start();
</code></pre>

</li>
<li>
<h4>
<div id="pause" style="color:red">pause()   ⇒ void</div>
</h4>
<p>暂停下载任务，如果任务已经处于初始状态或暂停状态则无任何响应。 通常在任务已开始后暂停任务。</p>
</li>
<li>
<h5>示例：</h5>
<pre><code>    var downloader = app.downloader.createDownload('url', {
        method: 'GET',
        timeout: 60,
        retry: 3,
        filePath: 'data://download/a.pdf'
    });

    downloader.pause();
</code></pre>

</li>
<li>
<h4>
<div id="resume" style="color:red">resume()   ⇒ void</div>
</h4>
<p>继续停止的下载任务，如果任务已经处于下载状态则无任何响应。 通常在任务已暂停任务后继续下载任务。</p>
</li>
<li>
<h5>示例：</h5>
<pre><code>    var downloader = app.downloader.createDownload('url', {
        method: 'GET',
        timeout: 60,
        retry: 3,
        filePath: 'data://download/a.pdf'
    });

    downloader.resume();
</code></pre>

</li>
<li>
<h4>
<div id="abort" style="color:red">abort()   ⇒ void</div>
</h4>
<p>取消下载任务，如果任务已经取消则无任何响应。 如果任务未完成，将删除已下载的临时文件。</p>
</li>
<li>
<h5>示例：</h5>
<pre><code>    var downloader = app.downloader.createDownload('url', {
        method: 'GET',
        timeout: 60,
        retry: 3,
        filePath: 'data://download/a.pdf'
    });

    downloader.abort();
</code></pre>

</li>
<li>
<h4>
<div id="addEventListener" style="color:red">addEventListener(listener)   ⇒ void</div>
</h4>
<p>添加下载任务事件监听器。</p>
<ul>
<li>
<strong>listener</strong>
：事件监听器回调
<ul>
  <li>
    <strong>type</strong>
    ：function
  </li>
  <li>
    <strong>默认值</strong>
    ：无
  </li>
  <li>
    <strong>参数</strong>
    <ul>
      <li>
        <strong>download</strong>
        ：下载任务对象
        <ul>
          <li>
            <strong>type</strong>
            ：
            <a href="#Downloader">Downloader</a>
          </li>
        </ul>
      </li>
      <li>
        <strong>status</strong>
        ：Http传输协议状态码，如下载成功其值通常为200
        <ul>
          <li>
            <strong>type</strong>
            ：Number
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
</li>
</ul>
</li>
<li>
<h5>示例：</h5>
<pre><code>    var downloader = app.downloader.createDownload('url', {
        method: 'GET',
        timeout: 60,
        retry: 3,
        filePath: 'data://download/a.pdf'
    });

    downloader.addEventListener(function(download,status){
        if(status == 200){
            console.log('下载连接创建成功！');
            console.log(download.state);
        }
    });
</code></pre>

</li>
<li>
<h4>
<div id="removeEventListener" style="color:red">removeEventListener()   ⇒ void</div>
</h4>
<p>移除任务事件监听器。</p>
</li>
<li>
<h5>示例：</h5>
<pre><code>    var downloader = app.downloader.createDownload('url', {
        method: 'GET',
        timeout: 60,
        retry: 3,
        filePath: 'data://download/a.pdf'
    });

    downloader.removeEventListener();
</code></pre>

</li>
<li>
<h4>
<div id="addCompletedListener" style="color:red">addCompletedListener(listener)   ⇒ void</div>
</h4>
<p>添加下载任务事件完成监听器。</p>
<ul>
<li>
<strong>listener</strong>
：事件监听器回调
<ul>
  <li>
    <strong>type</strong>
    ：function
  </li>
  <li>
    <strong>默认值</strong>
    ：无
  </li>
  <li>
    <strong>参数</strong>
    <ul>
      <li>
        <strong>download</strong>
        ：下载任务对象
        <ul>
          <li>
            <strong>type</strong>
            ：
            <a href="#Downloader">Downloader</a>
          </li>
        </ul>
      </li>
      <li>
        <strong>status</strong>
        ：Http传输协议状态码，如下载成功其值通常为200
        <ul>
          <li>
            <strong>type</strong>
            ：Number
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
</li>
</ul>
</li>
<li>
<h5>示例：</h5>
<pre><code>    var downloader = app.downloader.createDownload('url', {
        method: 'GET',
        timeout: 60,
        retry: 3,
        filePath: 'data://download/a.pdf'
    });

    downloader.addCompletedListener(function(download,status){
        console.log('下载成功！');
    });
</code></pre>

</li>
<li>
<h4>
<div id="removeCompletedListener" style="color:red">removeCompletedListener()   ⇒ void</div>
</h4>
<p>移除下载任务事件完成监听器。</p>
</li>
<li>
<h5>示例：</h5>
<pre><code>    var downloader = app.downloader.createDownload('url', {
        method: 'GET',
        timeout: 60,
        retry: 3,
        filePath: 'data://download/a.pdf'
    });

    downloader.removeCompletedListener();
</code></pre>

</li>
</ul>

</body>
</html>
<!-- This document was created with MarkdownPad, the Markdown editor for Windows (http://markdownpad.com) -->